

\documentclass[10pt]{article}
\usepackage{tikz}
\usepackage{tikz-3dplot}
\usepackage{pgf}
\usepackage[active,pdftex,tightpage]{preview}
\PreviewEnvironment[]{tikzpicture}

\usepackage{ifthen}

\usetikzlibrary{calc,3d,patterns,arrows}
\usetikzlibrary{decorations.pathreplacing}


\usepackage{amsthm,mathtools,pxfonts}


\begin{document}

\begin{tikzpicture}[scale=0.7,line join=round]


\draw [help lines, step=1] (0,0) grid (4,5);


\draw  (-0.5,0)  node[below] {\small Stack};
\draw  (0.5,0)  node[below] {\small 1};
\draw  (1.5,0)  node[below] {\small 2};
\draw  (2.5,0)  node[below] {\small 3};
\draw  (3.5,0)  node[below] {\small 4};



\draw [step=1] (0,0) grid (1,3);

\draw [fill=gray!40, step=1] (0,2) grid (1,3) rectangle(0,2);
\draw (0.5,0.5) node[] {\small 9};
\draw (0.5,0.5) node[above right] {\small $\blacksquare$};
\draw (0.5,1.5) node[] {\small 3};
\draw (0.5,1.5) node[above right] {\small $\square$};
\draw (0.5,2.5) node[] {\small 12};
\draw (0.5,2.5) node[above right] {\small $\times$};

\draw [step=1] (1,0) grid (2,3);
\draw [fill=gray!40, step=1] (1,0) grid (2,3) rectangle(1,0);
\draw (1.5,0.5) node[] {\small 6};
\draw (1.5,0.5) node[above right] {\small $\otimes$};
\draw (1.5,1.5) node[] {\small 8};
\draw (1.5,1.5) node[above right] {\small $\times$};
\draw (1.5,2.5) node[] {\small 2};
\draw (1.5,2.5) node[above right] {\small $\times$};

\draw [step=1] (2,0) grid (3,3);
\draw [fill=gray!40, step=1] (2,1) grid (3,3) rectangle(2,1);
\draw (2.5,0.5) node[] {\small 7};
\draw (2.5,0.5) node[above right] {\small $\blacksquare$};
\draw (2.5,1.5) node[] {\small 11};
\draw (2.5,1.5) node[above right] {\small $\times$};
\draw (2.5,2.5) node[] {\small 4};
\draw (2.5,2.5) node[above right] {\small $\times$};

\draw [step=1] (3,0) grid (4,3);
\draw (3.5,0.5) node[] {\small 10};
\draw (3.5,0.5) node[above right] {\small $\blacksquare$};
\draw (3.5,1.5) node[] {\small 5};
\draw (3.5,1.5) node[above right] {\small $\square$};
\draw (3.5,2.5) node[] {\small 1};
\draw (3.5,2.5) node[above right] {\small $\square$};


\draw (4,2.3) node[right] {\small \begin{tabular}{l}
$S=4$, $H=5$\\
$N=P=12$\\[3pt]
$\boldsymbol{h}=(3,3,3,3)$\\
$\boldsymbol{o}=(2,1,1,3)$\\
$\boldsymbol{g}=(2,0,1,3)$\\
$\boldsymbol{f}=(1,0,1,1)$\\[3pt]
$\times$: disorderly\\
$\otimes$: unstable orderly\\
$\square$: stable unfixed\\
$\blacksquare$: fixed
\end{tabular}
};


\end{tikzpicture}


\end{document}